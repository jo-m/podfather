# Demo compose file for podfather.
# Launches podfather alongside fake app containers.
# Start with: podman compose -f docker-compose.demo.yml up
# Browse to http://localhost:8080

include:
  - docker-compose.yml

services:
  # Override podfather service to add external app env vars.
  podfather:
    environment:
      PODMAN_SOCKET: /var/run/podman.sock
      LISTEN_ADDR: ":8080"
      # External apps (shown on dashboard without a container)
      PODFATHER_APP_ROUTER_NAME: "Router"
      PODFATHER_APP_ROUTER_ICON: "ğŸ“¡"
      PODFATHER_APP_ROUTER_CATEGORY: "Infrastructure"
      PODFATHER_APP_ROUTER_SORT_INDEX: "10"
      PODFATHER_APP_ROUTER_DESCRIPTION: "Network router admin interface"
      PODFATHER_APP_ROUTER_URL: "http://192.168.1.1"
      PODFATHER_APP_NAS_NAME: "NAS"
      PODFATHER_APP_NAS_ICON: "ğŸ’¾"
      PODFATHER_APP_NAS_CATEGORY: "Infrastructure"
      PODFATHER_APP_NAS_SORT_INDEX: "11"
      PODFATHER_APP_NAS_DESCRIPTION: "Synology network storage"
      PODFATHER_APP_NAS_URL: "http://192.168.1.2"

  # â”€â”€ Category: Media â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  jellyfin:
    image: docker.io/library/nginx:alpine
    container_name: jellyfin
    ports:
      - "8096:80"
    labels:
      ch.jo-m.go.podfather.app.name: "Jellyfin"
      ch.jo-m.go.podfather.app.icon: "ğŸ¬"
      ch.jo-m.go.podfather.app.category: "Media"
      ch.jo-m.go.podfather.app.sort-index: "1"
      ch.jo-m.go.podfather.app.description: "Stream your media library"
      ch.jo-m.go.podfather.app.url: "http://localhost:8096"
      io.containers.autoupdate: "registry"
    volumes:
      - jellyfin-config:/etc/nginx:ro
    restart: unless-stopped

  navidrome:
    image: docker.io/library/httpd:alpine
    container_name: navidrome
    ports:
      - "4533:80"
    labels:
      ch.jo-m.go.podfather.app.name: "Navidrome"
      ch.jo-m.go.podfather.app.icon: "ğŸµ"
      ch.jo-m.go.podfather.app.category: "Media"
      ch.jo-m.go.podfather.app.sort-index: "2"
      ch.jo-m.go.podfather.app.description: "Personal music streaming"
      ch.jo-m.go.podfather.app.url: "http://localhost:4533"
    restart: unless-stopped

  # â”€â”€ Category: Infrastructure â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  # Multi-container app: Gitea with its database
  gitea-web:
    image: docker.io/library/nginx:alpine
    container_name: gitea-web
    ports:
      - "3000:80"
    labels:
      ch.jo-m.go.podfather.app.name: "Gitea"
      ch.jo-m.go.podfather.app.icon: "ğŸµ"
      ch.jo-m.go.podfather.app.category: "Infrastructure"
      ch.jo-m.go.podfather.app.sort-index: "1"
      ch.jo-m.go.podfather.app.description: "Self-hosted Git service"
      ch.jo-m.go.podfather.app.url: "http://localhost:3000"
    restart: unless-stopped

  gitea-db:
    image: docker.io/library/alpine:latest
    container_name: gitea-db
    command: ["sleep", "infinity"]
    labels:
      ch.jo-m.go.podfather.app.name: "Gitea"
      ch.jo-m.go.podfather.app.category: "Infrastructure"
    restart: unless-stopped

  traefik:
    image: docker.io/library/nginx:alpine
    container_name: traefik
    ports:
      - "8088:80"
      - "8443:443"
    labels:
      ch.jo-m.go.podfather.app.name: "Traefik"
      ch.jo-m.go.podfather.app.icon: "ğŸ”€"
      ch.jo-m.go.podfather.app.category: "Infrastructure"
      ch.jo-m.go.podfather.app.sort-index: "0"
      ch.jo-m.go.podfather.app.description: "Reverse proxy & load balancer"
      ch.jo-m.go.podfather.app.url: "http://localhost:8088"
      io.containers.autoupdate: "registry"
    restart: unless-stopped

  # â”€â”€ Category: Monitoring â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  grafana:
    image: docker.io/library/httpd:alpine
    container_name: grafana
    ports:
      - "3001:80"
    labels:
      ch.jo-m.go.podfather.app.name: "Grafana"
      ch.jo-m.go.podfather.app.icon: "ğŸ“Š"
      ch.jo-m.go.podfather.app.category: "Monitoring"
      ch.jo-m.go.podfather.app.sort-index: "1"
      ch.jo-m.go.podfather.app.description: "Metrics dashboards & visualization"
      ch.jo-m.go.podfather.app.url: "http://localhost:3001"
    restart: unless-stopped

  prometheus:
    image: docker.io/library/alpine:latest
    container_name: prometheus
    command: ["sleep", "infinity"]
    labels:
      ch.jo-m.go.podfather.app.name: "Prometheus"
      ch.jo-m.go.podfather.app.icon: "ğŸ”¥"
      ch.jo-m.go.podfather.app.category: "Monitoring"
      ch.jo-m.go.podfather.app.sort-index: "2"
      ch.jo-m.go.podfather.app.description: "Time series metrics & monitoring"
    restart: unless-stopped

  # â”€â”€ Category: Uncategorized (no category label) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  whoami:
    image: docker.io/library/busybox:latest
    container_name: whoami
    command: ["httpd", "-f", "-p", "80"]
    ports:
      - "8089:80"
    labels:
      ch.jo-m.go.podfather.app.name: "Whoami"
      ch.jo-m.go.podfather.app.icon: "ğŸ‘‹"
      ch.jo-m.go.podfather.app.description: "Debug endpoint returning request info"
      ch.jo-m.go.podfather.app.url: "http://localhost:8089"
    restart: unless-stopped

  # â”€â”€ Containers without app labels (visible in Containers tab) â”€â”€â”€â”€

  redis:
    image: docker.io/library/alpine:latest
    container_name: redis
    command: ["sleep", "infinity"]
    restart: unless-stopped

  # Stopped container (exits immediately)
  batch-job:
    image: docker.io/library/alpine:latest
    container_name: batch-job
    command: ["echo", "done"]
    restart: "no"

  # Container with a volume mount
  backup:
    image: docker.io/library/busybox:latest
    container_name: backup
    command: ["sleep", "infinity"]
    volumes:
      - backup-data:/data
    restart: unless-stopped

volumes:
  jellyfin-config:
  backup-data:
